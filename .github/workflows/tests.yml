name: CI Pipeline

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  test:
    name: Build and Test
    runs-on: ubuntu-latest

    steps:
      # Скачивание репозитория
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Сборка Docker-образа
      - name: Build Container
        run: docker build --no-cache -t kotlin-gradle-tests .

      - name: Check JAVA_HOME
        run: ls -a /usr/lib/jvm/ && echo $JAVA_HOME && java -version

      # Запуск unit тестов
      - name: Run Unit Tests
        run: docker run --rm kotlin-gradle-tests gradle test --tests "unit"

      # Запуск integration тестов
      - name: Run Integration Tests
        run: docker run --rm kotlin-gradle-tests gradle test --tests "integration"

      # Запуск e2e тестов
      - name: Run E2E Tests
        run: docker run --rm kotlin-gradle-tests gradle test --tests "e2e"
